# ğŸ“ ARCHITECTURE DIAGRAM

## ğŸ—ï¸ MODULE STRUCTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MAIN_MODULAR.PY                         â”‚
â”‚                   (Entry Point & Loop)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚
         â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CONFIG.PY     â”‚   â”‚    STATS.PY     â”‚
â”‚                 â”‚   â”‚                 â”‚
â”‚ â€¢ Settings      â”‚   â”‚ â€¢ Track success â”‚
â”‚ â€¢ Thresholds    â”‚   â”‚ â€¢ Calculate     â”‚
â”‚ â€¢ Intervals     â”‚   â”‚ â€¢ Report        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (imported by)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WORKFLOW.PY                            â”‚
â”‚                  (Main Business Logic)                      â”‚
â”‚                                                             â”‚
â”‚  â€¢ execute_single_task()                                    â”‚
â”‚  â€¢ wait_and_solve_captcha()                                 â”‚
â”‚  â€¢ wait_for_button()                                        â”‚
â”‚  â€¢ take_smart_break()                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (uses)
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TASK_DETECTOR   â”‚   â”‚      TEMPLATE_MATCHER.PY            â”‚
â”‚     .PY         â”‚   â”‚                                     â”‚
â”‚                 â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â€¢ check_nv()    â”‚   â”‚  â”‚   TemplateCache               â”‚  â”‚
â”‚ â€¢ check_btn_xn()â”‚â—„â”€â”€â”¼â”€â”€â”¤   â€¢ Multi-scale templates     â”‚  â”‚
â”‚ â€¢ check_captra()â”‚   â”‚  â”‚   â€¢ Pre-loaded                â”‚  â”‚
â”‚ â€¢ click_task()  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â€¢ click_btn()   â”‚   â”‚                                     â”‚
â”‚ â€¢ etc...        â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   ScreenshotBuffer            â”‚  â”‚
           â”‚          â”‚  â”‚   â€¢ TTL cache (300ms)         â”‚  â”‚
           â”‚          â”‚  â”‚   â€¢ Reuse screenshots         â”‚  â”‚
           â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â”‚          â”‚                                     â”‚
           â”‚          â”‚  â€¢ match_template_multiscale()      â”‚
           â”‚          â”‚  â€¢ load_screenshot_bgr()            â”‚
           â–¼          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚      ADB_BRIDGE.PY              â”‚ â”‚
â”‚                                 â”‚ â”‚
â”‚  â€¢ adb_screencap_bytes() â—„â”€â”€â”€â”€â”€â”€â”˜
â”‚  â€¢ adb_tap()                    â”‚
â”‚  â€¢ adb_swipe()                  â”‚
â”‚  â€¢ adb_back()                   â”‚
â”‚  â€¢ scroll_up()                  â”‚
â”‚  â€¢ get_screen_size()            â”‚
â”‚                                 â”‚
â”‚  Supports:                      â”‚
â”‚  âœ“ Direct ADB                   â”‚
â”‚  âœ“ ADB Bridge (HTTP)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ WORKFLOW FLOW

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ensure_task_visible()   â”‚  â† Scroll if needed
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ click_task_title()      â”‚  â† Click nhiá»‡m vá»¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check_btn_start_video() â”‚  â† Kiá»ƒm tra loáº¡i task
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â”‚
   YESâ”‚         â”‚NO
     â”‚          â”‚
     â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video   â”‚  â”‚ check_time_cho()    â”‚
â”‚ Flow    â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         â”‚     â”‚         â”‚
â”‚ click   â”‚   YESâ”‚        â”‚NO
â”‚ start   â”‚     â”‚         â”‚
â”‚ back    â”‚     â”‚         â–¼
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚          â”‚   â”‚ check_captra â”‚
     â”‚          â”‚   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â”‚      â”‚
     â”‚          â”‚      â–¼
     â”‚          â”‚   Captcha?
     â”‚          â”‚      â”‚
     â”‚          â”‚    YESâ”‚
     â”‚          â”‚      â–¼
     â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚          â”‚   â”‚wait_and_solve_    â”‚
     â”‚          â”‚   â”‚captcha()           â”‚
     â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ wait_for_button()    â”‚  ğŸ”¥ OPTIMIZED!
            â”‚                      â”‚
            â”‚ Short task:          â”‚
            â”‚  â€¢ 0.4s Ã— 12         â”‚
            â”‚  â€¢ 0.6s Ã— 5          â”‚
            â”‚  â€¢ 1.0s Ã— 4          â”‚
            â”‚                      â”‚
            â”‚ Long task:           â”‚
            â”‚  â€¢ 2.0s Ã— 15         â”‚
            â”‚  â€¢ 3.0s Ã— 20         â”‚
            â”‚  â€¢ 5.0s Ã— 18         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ click_confirm_button â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                    SUCCESS
```

## ğŸ¯ OPTIMIZATION STRATEGY

```
NHIá»†M Vá»¤ NGáº®N TIMELINE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0s              2s              3s              10s
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Click Task   â”‚  Video Auto   â”‚    Button     â”‚
â”‚               â”‚  Playing      â”‚   Available   â”‚
â”‚               â”‚               â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚               â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  GOLDEN WINDOW
                                      ~7s
                                      
ğŸ”¥ CHECK STRATEGY (NEW):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0s    0.4   0.8   1.2   1.6   2.0   2.4   2.8   3.2   3.6
â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚
  âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“
  
4.0   4.4   4.8   5.4   6.0   6.6   7.2   7.8   8.8
â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚
  âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“

  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   12 checks    5 checks     4 checks
   (0.4s each)  (0.6s each)  (1.0s each)
   
   AGGRESSIVE   MODERATE      RELAXED
   
ğŸ“Š OLD vs NEW:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OLD: [1.0, 1.0, 1.0, 1.0, 2.0, 2.0, 3.0, 4.0]
0s    1     2     3     4     6     8    11    15
â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”‚
  âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“     âœ“

Miss rate in 0-5s window: 40%
Average response time: 2.5s

NEW: [0.4]*12 + [0.6]*5 + [1.0]*4
(shown above)

Miss rate in 0-5s window: 15%
Average response time: 1.2s

IMPROVEMENT: -62% miss rate, -52% response time! ğŸš€
```

## ğŸ§© MODULE DEPENDENCIES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   config    â”‚  â† No dependencies (base module)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                     â”‚
       â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ adb_bridge  â”‚      â”‚    stats    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚template_matcher â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ task_detector   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   workflow      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main_modular    â”‚  â† Top level
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Import order (bottom-up):
1. config
2. adb_bridge, stats
3. template_matcher
4. task_detector
5. workflow
6. main_modular
```

## ğŸ“Š DATA FLOW

```
USER
  â”‚
  â””â”€â–º main_modular.py
         â”‚
         â”œâ”€â–º stats.py (track progress)
         â”‚
         â””â”€â–º workflow.py
                â”‚
                â”œâ”€â–º task_detector.py
                â”‚      â”‚
                â”‚      â””â”€â–º template_matcher.py
                â”‚             â”‚
                â”‚             â””â”€â–º adb_bridge.py (screenshot)
                â”‚
                â””â”€â–º adb_bridge.py (tap/swipe/back)
                       â”‚
                       â””â”€â–º DEVICE

DEVICE
  â”‚
  â””â”€â–º adb_bridge.py
         â”‚
         â””â”€â–º template_matcher.py (ScreenshotBuffer)
                â”‚
                â””â”€â–º task_detector.py (check results)
                       â”‚
                       â””â”€â–º workflow.py (decisions)
                              â”‚
                              â””â”€â–º stats.py (record)
                                     â”‚
                                     â””â”€â–º USER (progress report)
```

## ğŸ¨ TEMPLATE MATCHING PIPELINE

```
Screenshot
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScreenshotBuffer     â”‚  â† Cache 300ms
â”‚ (template_matcher)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Template from        â”‚
â”‚ TemplateCache        â”‚  â† Pre-scaled versions
â”‚ (template_matcher)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Multi-scale          â”‚
â”‚ Matching             â”‚
â”‚ â€¢ Try each scale     â”‚
â”‚ â€¢ Early exit if >0.9 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Result               â”‚
â”‚ â€¢ found: bool        â”‚
â”‚ â€¢ confidence: float  â”‚
â”‚ â€¢ location: (x,y)    â”‚
â”‚ â€¢ bbox: (x,y,w,h)    â”‚
â”‚ â€¢ scale: float       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
